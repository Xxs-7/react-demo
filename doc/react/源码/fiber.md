# 简介
Fiber 是 React 16 引入的一种新的协调引擎（reconciler），用于解决和优化 React 应对渲染复杂 UI 时的性能问题。原先的协调引擎是递归处理 dom diff，当 dom 树非常庞大时，递归处理会占用大量的主线程资源，导致 UI 延迟渲染，甚至卡顿。

Fiber 将同步递归无法中断的更新重构为异步可中断更新。实现了 4 个具体目标：
1. **可中断渲染**：Fiber 将大的渲染任务拆分成多个小的工作单元（Unit of Work），当浏览器需要处理更高优先级的任务时（如用户输入、动画），React 的调度器通过优先级调度暂停渲染，先处理这些任务，然后再恢复未完成的渲染工作。
2. **优先级调度**：在 Fiber 架构下，React 可以根据不同任务的优先级决定何时更新哪些部分。React 会优先更新用户可感知的部分（如动画、用户输入），而低优先级的任务（如数据加载后的界面更新）可以延后执行。
3. **双缓存树（Fiber Tree）**：Fiber 架构中有两棵 Fiber 树——current fiber tree（当前正在渲染的 Fiber 树）和 work in progress fiber tree（正在处理的 Fiber 树）。更新渲染时 React 通过对这两个树进行节点对比（Reconciliation），通过复用节点或标记更新，减少不必要的创建和销毁，从而加快比对和更新过程。
4. **任务切片**：在浏览器的空闲时间内（利用 requestIdleCallback思想），React 可以将渲染任务拆分成多个小片段，逐步完成 Fiber 树的构建，避免一次性完成所有渲染任务导致的阻塞。

React 的渲染分初次渲染和更新渲染，初次渲染时，React 会创建一个 Fiber 树，这个树由 Fiber 节点组成，每个节点代表一个 React 元素。更新渲染时，React 会根据新的 React 元素和旧的 Fiber 树进行对比，生成新的 Fiber 树，然后通过对比新旧 Fiber 树的差异，生成一个更新队列，最后根据更新队列更新 DOM。



